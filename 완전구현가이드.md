# 안심톡 완전 구현 가이드

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [기술 스택](#기술-스택)
3. [설치 및 설정](#설치-및-설정)
4. [주요 기능 구현](#주요-기능-구현)
5. [배포 가이드](#배포-가이드)
6. [API 설정](#api-설정)
7. [문제 해결](#문제-해결)

## 🎯 프로젝트 개요

안심톡은 AI 기술을 활용하여 딥페이크와 사이버폭력을 분석하고 디지털 증거를 안전하게 증거화하는 웹 서비스입니다.

### 주요 기능
- **딥페이크 분석**: 이미지 파일의 진위 여부 분석
- **사이버폭력 분석**: 텍스트 및 이미지의 유해성 분석
- **PDF 증거보고서**: 법적 효력을 갖춘 상세 분석 보고서
- **상담/신고 안내**: 기관별 연락처 및 신고 방법 안내

## 🛠 기술 스택

### 백엔드
- **Python 3.12**: 메인 프로그래밍 언어
- **Flask 3.1.1**: 웹 프레임워크
- **Gunicorn 23.0.0**: WSGI 서버
- **Google Gemini API**: AI 분석
- **Google Cloud Vision API**: 이미지 분석
- **ReportLab 4.4.2**: PDF 생성

### 프론트엔드
- **HTML5/CSS3**: 반응형 웹 디자인
- **JavaScript**: 동적 인터페이스
- **NanumGothic 폰트**: 한글 최적화

### 배포
- **Railway**: 클라우드 플랫폼
- **Docker**: 컨테이너화
- **GitHub**: 버전 관리

## 🚀 설치 및 설정

### 1. 개발 환경 준비

```bash
# Python 3.12 설치 확인
python --version

# Git 설치 확인
git --version
```

### 2. 프로젝트 클론

```bash
git clone https://github.com/pjmin19/ansimtalk-.git
cd ansimtalk-
```

### 3. 가상환경 설정

```bash
# 가상환경 생성
python -m venv venv

# 가상환경 활성화 (Windows)
venv\Scripts\activate

# 가상환경 활성화 (macOS/Linux)
source venv/bin/activate
```

### 4. 의존성 설치

```bash
pip install -r requirements.txt
```

### 5. 환경 변수 설정

`.env` 파일 생성:

```env
SECRET_KEY=your-secret-key-here
GOOGLE_GEMINI_API_KEY=your-gemini-api-key
GOOGLE_CLOUD_VISION_API_KEY=your-vision-api-key
```

### 6. 애플리케이션 실행

```bash
python run.py
```

브라우저에서 `http://localhost:5000` 접속

## 🔧 주요 기능 구현

### 1. Flask 애플리케이션 구조

#### `app/__init__.py`
```python
from flask import Flask

def create_app():
    app = Flask(__name__)
    app.config.from_object('config')
    app.config['UPLOAD_FOLDER'] = app.config.get('UPLOAD_FOLDER')
    
    from . import routes
    app.register_blueprint(routes.bp)
    
    # pipe_table_to_html 필터 등록
    try:
        from .services import pipe_table_to_html
        app.jinja_env.filters['pipe_table_to_html'] = pipe_table_to_html
        print("=== pipe_table_to_html 필터 등록 완료 ===")
    except Exception as e:
        print(f"=== pipe_table_to_html 필터 등록 실패: {e} ===")
    
    return app
```

#### `config.py`
```python
import os
from dotenv import load_dotenv

load_dotenv()

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'dev-secret-key'
    GOOGLE_GEMINI_API_KEY = os.environ.get('GOOGLE_GEMINI_API_KEY')
    GOOGLE_CLOUD_VISION_API_KEY = os.environ.get('GOOGLE_CLOUD_VISION_API_KEY')
    UPLOAD_FOLDER = 'tmp'
    MAX_CONTENT_LENGTH = 5 * 1024 * 1024  # 5MB
```

### 2. 라우팅 구현

#### `app/routes.py`
주요 라우트:
- `/`: 메인 페이지
- `/analyze_deepfake`: 딥페이크 분석
- `/analyze_cyberbullying`: 사이버폭력 분석
- `/results`: 분석 결과 페이지
- `/download_pdf`: PDF 다운로드
- `/deepfake_help`, `/cyberbullying_help`: 상담 안내

### 3. 서비스 로직

#### `app/services.py`
주요 함수:
- `analyze_file()`: 파일 분석 통합 함수
- `analyze_deepfake()`: 딥페이크 분석
- `analyze_cyberbullying()`: 사이버폭력 분석
- `extract_text_from_image()`: 이미지 텍스트 추출
- `generate_pdf_report()`: PDF 증거보고서 생성

## 🌐 배포 가이드

### Railway 배포

#### 1. Railway 계정 생성
[Railway](https://railway.app)에서 GitHub 계정으로 로그인

#### 2. 프로젝트 연결
- GitHub 저장소 선택
- 자동 배포 활성화

#### 3. 환경 변수 설정
Railway 대시보드 > Settings > Variables에서:
```
SECRET_KEY=your-secret-key-here
GOOGLE_GEMINI_API_KEY=your-gemini-api-key
GOOGLE_CLOUD_VISION_API_KEY=your-vision-api-key
```

#### 4. 도메인 설정
- Settings > Domains에서 "Generate Domain" 클릭
- 제공된 URL로 서비스 접근

### Docker 설정

#### `Dockerfile`
```dockerfile
FROM python:3.12-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["sh", "-c", "gunicorn --bind 0.0.0.0:$PORT run:app"]
```

#### `railway.toml`
```toml
[build]
builder = "dockerfile"

[deploy]
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
```

## 🔑 API 설정

### Google Gemini API

#### 1. API 키 생성
1. [Google AI Studio](https://makersuite.google.com/app/apikey) 접속
2. "Create API Key" 클릭
3. API 키 복사

#### 2. 환경 변수 설정
```env
GOOGLE_GEMINI_API_KEY=your-actual-api-key
```

#### 3. 사용 예시
```python
import google.generativeai as genai

genai.configure(api_key=os.getenv('GOOGLE_GEMINI_API_KEY'))
model = genai.GenerativeModel('gemini-pro')
```

### Google Cloud Vision API

#### 1. 프로젝트 설정
1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 새 프로젝트 생성 또는 기존 프로젝트 선택
3. Vision API 활성화

#### 2. 서비스 계정 키 생성
1. IAM 및 관리 > 서비스 계정
2. 새 서비스 계정 생성
3. JSON 키 다운로드

#### 3. 환경 변수 설정
```env
GOOGLE_CLOUD_VISION_API_KEY=your-service-account-key
```

## 🐛 문제 해결

### 일반적인 문제들

#### 1. 빌드 타임아웃
**문제**: Railway에서 빌드 타임아웃 발생
**해결**: Dockerfile 사용 및 railway.toml 설정

#### 2. 포트 바인딩 오류
**문제**: 애플리케이션이 Railway 포트에 바인딩되지 않음
**해결**: `$PORT` 환경변수 사용

#### 3. API 키 오류
**문제**: Google API 키 인증 실패
**해결**: 환경 변수 확인 및 API 키 재생성

#### 4. PDF 생성 오류
**문제**: ReportLab PDF 생성 실패
**해결**: 임시 폴더 권한 확인

### 로그 확인 방법

#### Railway 로그
1. Railway 대시보드 > Deployments
2. 최신 배포 클릭
3. Build Logs / Deploy Logs 확인

#### 로컬 로그
```bash
# Flask 디버그 모드
export FLASK_DEBUG=1
python run.py
```

## 📊 성능 최적화

### 1. 파일 업로드 최적화
- 파일 크기 제한: 5MB
- 허용된 확장자만 업로드
- 임시 파일 자동 삭제

### 2. API 호출 최적화
- 비동기 처리 고려
- 캐싱 구현
- 에러 핸들링 강화

### 3. 보안 강화
- HTTPS 필수
- 입력 검증 강화
- XSS/CSRF 방어

## 🔄 업데이트 및 유지보수

### 1. 의존성 업데이트
```bash
pip install --upgrade -r requirements.txt
```

### 2. 코드 배포
```bash
git add .
git commit -m "Update description"
git push origin main
```

### 3. 환경 변수 업데이트
Railway 대시보드에서 환경 변수 수정

## 📞 지원 및 문의

### 개발팀
- **윤여준팀장** - 프로젝트 관리
- **김태양** - 백엔드 개발
- **김태영** - 프론트엔드 개발

### 문의 방법
- GitHub Issues: 버그 리포트 및 기능 제안
- 이메일: 프로젝트 관련 문의

---

**안심톡** - AI로 더 안전한 디지털 세상을 만들어갑니다. 